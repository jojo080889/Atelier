(function(){var CPGlobal,Color,Colorpicker,positionForEvent,size;size=200,positionForEvent=function(e){return"undefined"==typeof e.pageX?"undefined"==typeof e.originalEvent?null:e.originalEvent.changedTouches[0]:e},Color=function(){function Color(val){this.value={h:1,s:1,b:1,a:1},this.setColor(val)}return Color.prototype.setColor=function(val){var that;return val=val.toLowerCase(),that=this,$.each(CPGlobal.stringParsers,function(i,parser){var match,space,values;return match=parser.re.exec(val),values=match&&parser.parse(match),space=parser.space||"rgba",values?(that.value="hsla"===space?CPGlobal.RGBtoHSB.apply(null,CPGlobal.HSLtoRGB.apply(null,values)):CPGlobal.RGBtoHSB.apply(null,values),!1):void 0})},Color.prototype.setHue=function(h){return this.value.h=1-h},Color.prototype.setSaturation=function(s){return this.value.s=s},Color.prototype.setLightness=function(b){return this.value.b=1-b},Color.prototype.setAlpha=function(a){return this.value.a=parseInt(100*(1-a),10)/100},Color.prototype.toRGB=function(h,s,b,a){var B,C,G,R,X;return h||(h=this.value.h,s=this.value.s,b=this.value.b),h*=360,R=void 0,G=void 0,B=void 0,X=void 0,C=void 0,h=h%360/60,C=b*s,X=C*(1-Math.abs(h%2-1)),R=G=B=b-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],{r:Math.round(255*R),g:Math.round(255*G),b:Math.round(255*B),a:a||this.value.a}},Color.prototype.toHex=function(h,s,b,a){var g,r,rgb;return rgb=this.toRGB(h,s,b,a),r=parseInt(rgb.r,10)<<16,g=parseInt(rgb.g,10)<<8,b=parseInt(rgb.b,10),"#"+(1<<24|r|g|b).toString(16).substr(1)},Color.prototype.toHSL=function(h,s,b,a){var H,L,S;return h||(h=this.value.h,s=this.value.s,b=this.value.b),H=h,L=(2-s)*b,S=s*b,S/=L>0&&1>=L?L:2-L,L/=2,S>1&&(S=1),{h:H,s:S,l:L,a:a||this.value.a}},Color}(),Colorpicker=function(){function Colorpicker(element,options){var format;this.element=$(element),format=options.format||this.element.data("color-format")||"hex",this.format=CPGlobal.translateFormats[format],this.isInput=this.element.is("input"),this.component=this.element.is(".color")?this.element.find(".add-on"):!1,this.picker=$(CPGlobal.template).appendTo("body"),this.picker.on("mousedown",$.proxy(this.mousedown,this)),this.picker.on("touchstart",$.proxy(this.mousedown,this)),this.isInput&&this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)}),("rgba"===format||"hsla"===format)&&(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update()}return Colorpicker.prototype.show=function(e){return this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),$(window).on("resize",$.proxy(this.place,this)),this.isInput||e&&(e.stopPropagation(),e.preventDefault()),this.element.trigger({type:"show",color:this.color})},Colorpicker.prototype.update=function(){return this.color=new Color(this.isInput?this.element.prop("value"):this.element.data("color")),this.picker.find("i").eq(0).css({left:this.color.value.s*size,top:size-this.color.value.b*size}).end().eq(1).css("top",size*(1-this.color.value.h)).end().eq(2).css("top",size*(1-this.color.value.a)),this.previewColor()},Colorpicker.prototype.setValue=function(newColor){return this.color=new Color(newColor),this.picker.find("i").eq(0).css({left:this.color.value.s*size,top:size-this.color.value.b*size}).end().eq(1).css("top",size*(1-this.color.value.h)).end().eq(2).css("top",size*(1-this.color.value.a)),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color})},Colorpicker.prototype.hide=function(){return this.picker.hide(),$(window).off("resize",this.place),this.isInput?this.element.prop("value",this.format.call(this)):(this.component&&this.element.find("input").prop("value",this.format.call(this)),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hide",color:this.color})},Colorpicker.prototype.place=function(){var offset,thing;return thing=this.component?this.component:this.element,offset=thing.offset(),this.picker.css({top:offset.top-(thing.height()+this.picker.height()),left:offset.left})},Colorpicker.prototype.previewColor=function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}return this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha?this.alpha.backgroundColor=this.color.toHex():void 0},Colorpicker.prototype.pointer=null,Colorpicker.prototype.slider=null,Colorpicker.prototype.mousedown=function(e){var offset,p,target,zone;if(e.stopPropagation(),e.preventDefault(),target=$(e.target),zone=target.closest("div"),!zone.is(".colorpicker")){if(zone.is(".colorpicker-saturation"))this.slider=$.extend({},CPGlobal.sliders.saturation);else if(zone.is(".colorpicker-hue"))this.slider=$.extend({},CPGlobal.sliders.hue);else{if(!zone.is(".colorpicker-alpha"))return!1;this.slider=$.extend({},CPGlobal.sliders.alpha)}offset=zone.offset(),p=positionForEvent(e),this.slider.knob=zone.find("i")[0].style,this.slider.left=p.pageX-offset.left,this.slider.top=p.pageY-offset.top,this.pointer={left:p.pageX,top:p.pageY},$(this.picker).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this),touchmove:$.proxy(this.mousemove,this),touchend:$.proxy(this.mouseup,this),touchcancel:$.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},Colorpicker.prototype.mousemove=function(e){var left,p,top,x,y;return e.stopPropagation(),e.preventDefault(),p=positionForEvent(e),x=p?p.pageX:this.pointer.left,y=p?p.pageY:this.pointer.top,left=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+(x-this.pointer.left))),top=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+(y-this.pointer.top))),this.slider.knob.left=left+"px",this.slider.knob.top=top+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,left/size),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,top/size),this.previewColor(),this.element.trigger({type:"changeColor",color:this.color}),!1},Colorpicker.prototype.mouseup=function(e){return e.stopPropagation(),e.preventDefault(),$(this.picker).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},Colorpicker}(),$.fn.colorpicker=function(option){return this.each(function(){var $this,data,options;return $this=$(this),data=$this.data("colorpicker"),options="object"==typeof option&&option,data||$this.data("colorpicker",data=new Colorpicker(this,$.extend({},$.fn.colorpicker.defaults,options))),"string"==typeof option?data[option]():void 0})},$.fn.colorpicker.defaults={},$.fn.colorpicker.Constructor=Colorpicker,CPGlobal={translateFormats:{rgb:function(){var rgb;return rgb=this.color.toRGB(),"rgb("+rgb.r+","+rgb.g+","+rgb.b+")"},rgba:function(){var rgb;return rgb=this.color.toRGB(),"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+rgb.a+")"},hsl:function(){var hsl;return hsl=this.color.toHSL(),"hsl("+Math.round(360*hsl.h)+","+Math.round(100*hsl.s)+"%,"+Math.round(100*hsl.l)+"%)"},hsla:function(){var hsl;return hsl=this.color.toHSL(),"hsla("+Math.round(360*hsl.h)+","+Math.round(100*hsl.s)+"%,"+Math.round(100*hsl.l)+"%,"+hsl.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:size,maxTop:size,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:size,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:size,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(r,g,b,a){var C,H,S,V;return r/=255,g/=255,b/=255,H=void 0,S=void 0,V=void 0,C=void 0,V=Math.max(r,g,b),C=V-Math.min(r,g,b),H=0===C?null:V===r?(g-b)/C:V===g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0===C?0:C/V,{h:H||1,s:S,b:V,a:a||1}},HueToRGB:function(p,q,h){return 0>h?h+=1:h>1&&(h-=1),1>6*h?p+(q-p)*h*6:1>2*h?q:2>3*h?p+(q-p)*(2/3-h)*6:p},HSLtoRGB:function(h,s,l,a){var b,g,p,q,r,tb,tg,tr;return 0>s&&(s=0),q=void 0,q=.5>=l?l*(1+s):l+s-l*s,p=2*l-q,tr=h+1/3,tg=h,tb=h-1/3,r=Math.round(255*CPGlobal.HueToRGB(p,q,tr)),g=Math.round(255*CPGlobal.HueToRGB(p,q,tg)),b=Math.round(255*CPGlobal.HueToRGB(p,q,tb)),[r,g,b,a||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],execResult[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1]/360,execResult[2]/100,execResult[3]/100,execResult[4]]}}],template:'<div class="colorpicker">\n  <div class="colorpicker-saturation">\n    <i>\n      <b></b>\n    </i>\n  </div>\n  <div class="colorpicker-hue">\n    <i></i>\n  </div>\n  <div class="colorpicker-alpha">\n    <i></i>\n  </div>\n  <div class="colorpicker-color">\n    <div></div>\n  </div>\n</div>"'}}).call(this),function(){var _ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.LC=null!=(_ref=window.LC)?_ref:{},LC.LiterallyCanvas=function(){function LiterallyCanvas(canvas,opts){var backgroundImage,_this=this;this.canvas=canvas,this.opts=opts,this.updateSize=__bind(this.updateSize,this),this.$canvas=$(this.canvas),LC.bindEvents(this,this.canvas,this.opts.keyboardShortcuts),this.colors={primary:this.opts.primaryColor||"#000",secondary:this.opts.secondaryColor||"#fff",background:this.opts.backgroundColor||"transparent"},$(this.canvas).css("background-color",this.colors.background),this.watermarkImage=this.opts.watermarkImage,this.watermarkImage&&!this.watermarkImage.complete&&(this.watermarkImage.onload=function(){return _this.repaint(!0,!1)}),this.buffer=$("<canvas>").get(0),this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backgroundShapes=[],this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.tool=void 0,this.opts.preserveCanvasContents&&(backgroundImage=new Image,backgroundImage.src=this.canvas.toDataURL(),backgroundImage.onload=function(){return _this.repaint()},this.backgroundShapes.push(new LC.ImageShape(0,0,backgroundImage))),this.backgroundShapes=this.backgroundShapes.concat(this.opts.backgroundShapes||[]),this.repaint()}return LiterallyCanvas.prototype.updateSize=function(){return this.$canvas.attr("width",this.$canvas.width()),this.$canvas.attr("height",this.$canvas.height()),this.repaint()},LiterallyCanvas.prototype.trigger=function(name,data){return this.canvas.dispatchEvent(new CustomEvent(name,{detail:data}))},LiterallyCanvas.prototype.on=function(name,fn){return this.canvas.addEventListener(name,function(e){return fn(e.detail)})},LiterallyCanvas.prototype.clientCoordsToDrawingCoords=function(x,y){return{x:(x-this.position.x)/this.scale,y:(y-this.position.y)/this.scale}},LiterallyCanvas.prototype.drawingCoordsToClientCoords=function(x,y){return{x:x*this.scale+this.position.x,y:y*this.scale+this.position.y}},LiterallyCanvas.prototype.setTool=function(tool){return this.tool=tool,this.trigger("toolChange",{tool:tool})},LiterallyCanvas.prototype.begin=function(x,y){var newPos;return newPos=this.clientCoordsToDrawingCoords(x,y),this.tool.begin(newPos.x,newPos.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})},LiterallyCanvas.prototype["continue"]=function(x,y){var newPos;return newPos=this.clientCoordsToDrawingCoords(x,y),this.isDragging?(this.tool["continue"](newPos.x,newPos.y,this),this.trigger("drawContinue",{tool:this.tool})):void 0},LiterallyCanvas.prototype.end=function(x,y){var newPos;return newPos=this.clientCoordsToDrawingCoords(x,y),this.isDragging?(this.tool.end(newPos.x,newPos.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):void 0},LiterallyCanvas.prototype.setColor=function(name,color){return this.colors[name]=color,$(this.canvas).css("background-color",this.colors.background),this.trigger(""+name+"ColorChange",this.colors[name]),this.repaint()},LiterallyCanvas.prototype.getColor=function(name){return this.colors[name]},LiterallyCanvas.prototype.saveShape=function(shape){return this.execute(new LC.AddShapeAction(this,shape)),this.trigger("shapeSave",{shape:shape}),this.trigger("drawingChange",{shape:shape})},LiterallyCanvas.prototype.numShapes=function(){return this.shapes.length},LiterallyCanvas.prototype.pan=function(x,y){return this.position.x=this.position.x-x,this.position.y=this.position.y-y,this.trigger("pan",{x:this.position.x,y:this.position.y})},LiterallyCanvas.prototype.zoom=function(factor){var oldScale;return oldScale=this.scale,this.scale=this.scale+factor,this.scale=Math.max(this.scale,.6),this.scale=Math.min(this.scale,4),this.scale=Math.round(100*this.scale)/100,this.position.x=LC.scalePositionScalar(this.position.x,this.canvas.width,oldScale,this.scale),this.position.y=LC.scalePositionScalar(this.position.y,this.canvas.height,oldScale,this.scale),this.repaint(),this.trigger("zoom",{oldScale:oldScale,newScale:this.scale})},LiterallyCanvas.prototype.repaint=function(dirty,drawBackground){var retryCallback,_this=this;return null==dirty&&(dirty=!0),null==drawBackground&&(drawBackground=!1),retryCallback=function(){return _this.repaint(!0)},dirty&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),drawBackground&&(this.bufferCtx.fillStyle=this.colors.background,this.bufferCtx.fillRect(0,0,this.buffer.width,this.buffer.height)),this.watermarkImage&&this.bufferCtx.drawImage(this.watermarkImage,this.canvas.width/2-this.watermarkImage.width/2,this.canvas.height/2-this.watermarkImage.height/2),this.draw(this.backgroundShapes,this.bufferCtx,retryCallback),this.draw(this.shapes,this.bufferCtx,retryCallback)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&this.ctx.drawImage(this.buffer,0,0),this.trigger("repaint",null)},LiterallyCanvas.prototype.update=function(shape){var _this=this;return this.repaint(!1),this.transformed(function(){return shape.update(_this.ctx)},this.ctx)},LiterallyCanvas.prototype.draw=function(shapes,ctx,retryCallback){var drawShapes;if(shapes.length)return drawShapes=function(){var shape,_i,_len,_results;for(_results=[],_i=0,_len=shapes.length;_len>_i;_i++)shape=shapes[_i],_results.push(shape.draw(ctx,retryCallback));return _results},this.transformed(drawShapes,ctx)},LiterallyCanvas.prototype.transformed=function(fn,ctx){return ctx.save(),ctx.translate(this.position.x,this.position.y),ctx.scale(this.scale,this.scale),fn(),ctx.restore()},LiterallyCanvas.prototype.clear=function(){var newShapes,oldShapes;return oldShapes=this.shapes,newShapes=[],this.execute(new LC.ClearAction(this,oldShapes,newShapes)),this.repaint(),this.trigger("clear",null),this.trigger("drawingChange",{})},LiterallyCanvas.prototype.execute=function(action){return this.undoStack.push(action),action["do"](),this.redoStack=[]},LiterallyCanvas.prototype.undo=function(){var action;if(this.undoStack.length)return action=this.undoStack.pop(),action.undo(),this.redoStack.push(action),this.trigger("undo",{action:action}),this.trigger("drawingChange",{})},LiterallyCanvas.prototype.redo=function(){var action;if(this.redoStack.length)return action=this.redoStack.pop(),this.undoStack.push(action),action["do"](),this.trigger("redo",{action:action}),this.trigger("drawingChange",{})},LiterallyCanvas.prototype.getPixel=function(x,y){var p,pixel;return p=this.drawingCoordsToClientCoords(x,y),pixel=this.ctx.getImageData(p.x,p.y,1,1).data,pixel[3]?"rgb("+pixel[0]+", "+pixel[1]+", "+pixel[2]+")":null},LiterallyCanvas.prototype.canvasForExport=function(){return this.repaint(!0,!0),this.canvas},LiterallyCanvas.prototype.getSnapshot=function(){var shape,_i,_len,_ref2,_results;for(_ref2=this.shapes,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)shape=_ref2[_i],_results.push(shape.toJSON());return _results},LiterallyCanvas.prototype.getSnapshotJSON=function(){return JSON.stringify(this.shapes)},LiterallyCanvas.prototype.loadSnapshot=function(snapshot){var shape,shapeRepr,_i,_len;for(this.shapes=[],this.repaint(!0),_i=0,_len=snapshot.length;_len>_i;_i++)shapeRepr=snapshot[_i],shapeRepr.className in LC&&(shape=LC[shapeRepr.className].fromJSON(this,shapeRepr.data),shape&&this.execute(new LC.AddShapeAction(this,shape)));return this.repaint(!0)},LiterallyCanvas.prototype.loadSnapshotJSON=function(str){return this.loadSnapshot(JSON.parse(str)),this.repaint(!0)},LiterallyCanvas}(),LC.ClearAction=function(){function ClearAction(lc,oldShapes,newShapes){this.lc=lc,this.oldShapes=oldShapes,this.newShapes=newShapes}return ClearAction.prototype["do"]=function(){return this.lc.shapes=this.newShapes,this.lc.repaint()},ClearAction.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaint()},ClearAction}(),LC.AddShapeAction=function(){function AddShapeAction(lc,shape){this.lc=lc,this.shape=shape}return AddShapeAction.prototype["do"]=function(){return this.ix=this.lc.shapes.length,this.lc.shapes.push(this.shape),this.lc.repaint()},AddShapeAction.prototype.undo=function(){return this.lc.shapes.pop(this.ix),this.lc.repaint()},AddShapeAction}()}.call(this),function(){var buttonIsDown,coordsForTouchEvent,position;coordsForTouchEvent=function($el,e){var p,tx,ty;return tx=e.originalEvent.changedTouches[0].pageX,ty=e.originalEvent.changedTouches[0].pageY,p=$el.offset(),[tx-p.left,ty-p.top]},position=function(e){var p;return null!=e.offsetX?{left:e.offsetX,top:e.offsetY}:(p=$(e.target).offset(),{left:e.pageX-p.left,top:e.pageY-p.top})},buttonIsDown=function(e){return null!=e.buttons?1===e.buttons:e.which>0},LC.bindEvents=function(lc,canvas,panWithKeyboard){var $c;return null==panWithKeyboard&&(panWithKeyboard=!1),$c=$(canvas),$c.mousedown(function(e){var down,p;return down=!0,e.originalEvent.preventDefault(),document.onselectstart=function(){return!1},p=position(e),lc.begin(p.left,p.top)}),$c.mousemove(function(e){var p;return e.originalEvent.preventDefault(),p=position(e),lc["continue"](p.left,p.top)}),$c.mouseup(function(e){var p;return e.originalEvent.preventDefault(),document.onselectstart=function(){return!0},p=position(e),lc.end(p.left,p.top)}),$c.mouseenter(function(e){var p;return p=position(e),buttonIsDown(e)?lc.begin(p.left,p.top):void 0}),$c.mouseout(function(e){var p;return p=position(e),lc.end(p.left,p.top)}),$c.bind("touchstart",function(e){return e.preventDefault(),1===e.originalEvent.touches.length?lc.begin.apply(lc,coordsForTouchEvent($c,e)):lc["continue"].apply(lc,coordsForTouchEvent($c,e))}),$c.bind("touchmove",function(e){return e.preventDefault(),lc["continue"].apply(lc,coordsForTouchEvent($c,e))}),$c.bind("touchend",function(e){return e.preventDefault(),0===e.originalEvent.touches.length?lc.end.apply(lc,coordsForTouchEvent($c,e)):void 0}),$c.bind("touchcancel",function(e){return e.preventDefault(),0===e.originalEvent.touches.length?lc.end.apply(lc,coordsForTouchEvent($c,e)):void 0}),panWithKeyboard?$(document).keydown(function(e){switch(e.which){case 37:lc.pan(-10,0);break;case 38:lc.pan(0,-10);break;case 39:lc.pan(10,0);break;case 40:lc.pan(0,10)}return lc.repaint()}):void 0}}.call(this),function(){var dual,mid,normals,refine,slope,unit,_ref;window.LC=null!=(_ref=window.LC)?_ref:{},LC.bspline=function(points,order){return order?LC.bspline(dual(dual(refine(points))),order-1):points},refine=function(points){var index,point,refined,_i,_len;for(points=[points[0]].concat(points).concat(LC._last(points)),refined=[],index=0,_i=0,_len=points.length;_len>_i;_i++)point=points[_i],refined[2*index]=point,points[index+1]&&(refined[2*index+1]=mid(point,points[index+1])),index+=1;return refined},dual=function(points){var dualed,index,point,_i,_len;for(dualed=[],index=0,_i=0,_len=points.length;_len>_i;_i++)point=points[_i],points[index+1]&&(dualed[index]=mid(point,points[index+1])),index+=1;return dualed},mid=function(a,b){return new LC.Point(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2,a.size+(b.size-a.size)/2,a.color)},LC.toPoly=function(line){var index,n,point,polyLeft,polyRight,_i,_len;for(polyLeft=[],polyRight=[],index=0,_i=0,_len=line.length;_len>_i;_i++)point=line[_i],n=normals(point,slope(line,index)),polyLeft=polyLeft.concat([n[0]]),polyRight=[n[1]].concat(polyRight),index+=1;return polyLeft.concat(polyRight)},slope=function(line,index){var point;return line.length<3&&(point={x:0,y:0}),point=0===index?slope(line,index+1):index===line.length-1?slope(line,index-1):LC.diff(line[index-1],line[index+1])},LC.diff=function(a,b){return{x:b.x-a.x,y:b.y-a.y}},unit=function(vector){var length;return length=LC.len(vector),{x:vector.x/length,y:vector.y/length}},normals=function(p,slope){return slope=unit(slope),slope.x=slope.x*p.size/2,slope.y=slope.y*p.size/2,[{x:p.x-slope.y,y:p.y+slope.x,color:p.color},{x:p.x+slope.y,y:p.y-slope.x,color:p.color}]},LC.len=function(vector){return Math.sqrt(Math.pow(vector.x,2)+Math.pow(vector.y,2))},LC.scalePositionScalar=function(val,viewportSize,oldScale,newScale){var newSize,oldSize;return oldSize=viewportSize*oldScale,newSize=viewportSize*newScale,val+(oldSize-newSize)/2}}.call(this),function(){var _ref,__hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};window.LC=null!=(_ref=window.LC)?_ref:{},LC.Shape=function(){function Shape(){}return Shape.prototype.className=null,Shape.prototype.draw=function(){},Shape.prototype.update=function(ctx){return this.draw(ctx)},Shape.prototype.toJSON=function(){return{className:this.className,data:this.jsonContent()}},Shape.prototype.jsonContent=function(){return raise("not implemented")},Shape.fromJSON=function(){return raise("not implemented")},Shape}(),LC.ImageShape=function(_super){function ImageShape(x,y,image){this.x=x,this.y=y,this.image=image}return __extends(ImageShape,_super),ImageShape.prototype.className="ImageShape",ImageShape.prototype.draw=function(ctx,retryCallback){return this.image.width?ctx.drawImage(this.image,this.x,this.y):this.image.onload=retryCallback},ImageShape.prototype.jsonContent=function(){return{x:this.x,y:this.y,imageSrc:this.image.src}},ImageShape.fromJSON=function(lc,data){var i,img;return img=new Image,img.src=data.imageSrc,i=new LC.ImageShape(data.x,data.y,img)},ImageShape}(LC.Shape),LC.Rectangle=function(_super){function Rectangle(x,y,strokeWidth,strokeColor,fillColor){this.x=x,this.y=y,this.strokeWidth=strokeWidth,this.strokeColor=strokeColor,this.fillColor=fillColor,this.width=0,this.height=0}return __extends(Rectangle,_super),Rectangle.prototype.className="Rectangle",Rectangle.prototype.draw=function(ctx){return ctx.fillStyle=this.fillColor,ctx.fillRect(this.x,this.y,this.width,this.height),ctx.lineWidth=this.strokeWidth,ctx.strokeStyle=this.strokeColor,ctx.strokeRect(this.x,this.y,this.width,this.height)},Rectangle.prototype.jsonContent=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},Rectangle.fromJSON=function(lc,data){var shape;return shape=new LC.Rectangle(data.x,data.y,data.strokeWidth,data.strokeColor,data.fillColor),shape.width=data.width,shape.height=data.height,shape},Rectangle}(LC.Shape),LC.Line=function(_super){function Line(x1,y1,x2,y2,strokeWidth,color){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2,this.strokeWidth=strokeWidth,this.color=color}return __extends(Line,_super),Line.prototype.className="Line",Line.prototype.draw=function(ctx){return ctx.lineWidth=this.strokeWidth,ctx.strokeStyle=this.color,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(this.x1,this.y1),ctx.lineTo(this.x2,this.y2),ctx.stroke()},Line.prototype.jsonContent=function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color}},Line.fromJSON=function(lc,data){var shape;return shape=new LC.Line(data.x1,data.y1,data.x2,data.y2,data.strokeWidth,data.color)},Line}(LC.Shape),LC.LinePathShape=function(_super){function LinePathShape(_points,order,tailSize){var point,_i,_len;for(null==_points&&(_points=[]),this.order=null!=order?order:3,this.tailSize=null!=tailSize?tailSize:3,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,this.points=[],_i=0,_len=_points.length;_len>_i;_i++)point=_points[_i],this.addPoint(point)}return __extends(LinePathShape,_super),LinePathShape.prototype.className="LinePathShape",LinePathShape.prototype.jsonContent=function(){return{order:this.order,tailSize:this.tailSize,points:this.points}},LinePathShape.fromJSON=function(lc,data){var pointData,points;return points=function(){var _i,_len,_ref2,_results;for(_ref2=data.points,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)pointData=_ref2[_i],_results.push(new LC.Point.fromJSON(lc,pointData));return _results}(),new LC.LinePathShape(points,data.order,data.tailSize)},LinePathShape.prototype.addPoint=function(point){return this.points.push(point),!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=LC.bspline(this.points,this.order):(this.tail=LC._last(LC.bspline(LC._last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail))},LinePathShape.prototype.draw=function(ctx){var point,points,_i,_len,_ref2;if(points=this.smoothedPoints,points.length){for(ctx.strokeStyle=points[0].color,ctx.lineWidth=points[0].size,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),_ref2=points.slice(1),_i=0,_len=_ref2.length;_len>_i;_i++)point=_ref2[_i],ctx.lineTo(point.x,point.y);return ctx.stroke()}},LinePathShape}(LC.Shape),LC.EraseLinePathShape=function(_super){function EraseLinePathShape(){EraseLinePathShape.__super__.constructor.apply(this,arguments)}return __extends(EraseLinePathShape,_super),EraseLinePathShape.prototype.className="EraseLinePathShape",EraseLinePathShape.prototype.draw=function(ctx){return ctx.save(),ctx.globalCompositeOperation="destination-out",EraseLinePathShape.__super__.draw.call(this,ctx),ctx.restore()},EraseLinePathShape.prototype.update=function(ctx){return ctx.save(),ctx.globalCompositeOperation="destination-out",EraseLinePathShape.__super__.update.call(this,ctx),ctx.restore()},EraseLinePathShape.fromJSON=function(lc,data){var pointData,points;return points=function(){var _i,_len,_ref2,_results;for(_ref2=data.points,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)pointData=_ref2[_i],_results.push(new LC.Point.fromJSON(lc,pointData));return _results}(),new LC.EraseLinePathShape(points,data.order,data.tailSize)},EraseLinePathShape}(LC.LinePathShape),LC.Point=function(){function Point(x,y,size,color){this.x=x,this.y=y,this.size=size,this.color=color}return Point.prototype.className="Point",Point.prototype.lastPoint=function(){return this},Point.prototype.draw=function(){return console.log("draw point",this.x,this.y,this.size,this.color)},Point.prototype.jsonContent=function(){return{x:this.x,y:this.y,size:this.size,color:this.color}},Point.fromJSON=function(lc,data){return new LC.Point(data.x,data.y,data.size,data.color)},Point}(),LC.TextShape=function(_super){function TextShape(x,y,text,color){this.x=x,this.y=y,this.text=text,this.color=color}return __extends(TextShape,_super),TextShape.prototype.className="TextShape",TextShape.prototype.draw=function(ctx){return ctx.font="bold 18px sans-serif",ctx.fillStyle=this.color,ctx.fillText(this.text,this.x,this.y)},TextShape.prototype.jsonContent=function(){return{x:this.x,y:this.y,text:this.text}},TextShape.fromJSON=function(lc,data){return new LC.TextShape(data.x,data.y,data.text)},TextShape}(LC.Shape)}.call(this),function(){var _ref;window.LC=null!=(_ref=window.LC)?_ref:{},LC.toolbarHTML='  <div class="toolbar-row">    <div class="toolbar-row-left">      <div class="tools button-group"></div>      &nbsp;&nbsp;&nbsp;&nbsp;Background:      <div class="color-square background-picker">&nbsp;</div>    </div>    <div class="toolbar-row-right">      <div class="action-buttons">        <div class="button clear-button danger">Clear</div>        <div class="button-group">          <div class="button btn-warning undo-button">&larr;</div><div class="button btn-warning redo-button">&rarr;</div>        </div>        <div class="button-group">          <div class="button btn-inverse zoom-out-button">&ndash;</div><div class="button btn-inverse zoom-in-button">+</div>        </div>        <div class="zoom-display">1</div>      </div>    </div>    <div class="clearfix"></div>  </div>  <div class="toolbar-row">    <div class="toolbar-row-left">      <div class="color-square primary-picker"></div>      <div class="color-square secondary-picker"></div>      <div class="tool-options-container"></div>    </div>    <div class="clearfix"></div>  </div>',LC.makeColorPicker=function($el,title,callback){var cp;return $el.data("color","rgb(0, 0, 0)"),cp=$el.colorpicker({format:"rgba"}).data("colorpicker"),cp.hide(),$el.on("changeColor",function(e){return callback(e.color.toRGB()),$(document).one("click",function(){return cp.hide()})}),$el.click(function(){return cp.picker.is(":visible")?cp.hide():($(document).one("click",function(){return $(document).one("click",function(){return cp.hide()})}),cp.show(),cp.place())}),cp},LC.Toolbar=function(){function Toolbar(lc,$el,opts){this.lc=lc,this.$el=$el,this.opts=opts,this.$el.append(LC.toolbarHTML),this.initColors(),this.initButtons(),this.initTools(),this.initZoom()}return Toolbar.prototype._bindColorPicker=function(name,title){var $el,_this=this;return $el=this.$el.find("."+name+"-picker"),$el.css("background-color",this.lc.getColor(name)),$el.css("background-position","0% 0%"),this.lc.on(""+name+"ColorChange",function(color){return $el.css("background-color",color)}),LC.makeColorPicker($el,""+title+" color",function(c){return _this.lc.setColor(name,"rgba("+c.r+", "+c.g+", "+c.b+", "+c.a+")"),$el.css("background-position","0% "+100*(1-c.a)+"%")})},Toolbar.prototype.initColors=function(){var pickers;return this.$el.find(".primary-picker, .secondary-picker, .background-picker").css("background-image","url("+this.opts.imageURLPrefix+"/alpha.png)"),this.$el.find(".secondary-picker").css("background-position","0% 100%"),pickers=[this._bindColorPicker("primary","Primary (stroke)"),this._bindColorPicker("secondary","Secondary (fill)"),this._bindColorPicker("background","Background")],this.lc.$canvas.mousedown(function(){var picker,_i,_len,_results;for(_results=[],_i=0,_len=pickers.length;_len>_i;_i++)picker=pickers[_i],_results.push(picker.hide());return _results}),this.lc.$canvas.on("touchstart",function(){var picker,_i,_len,_results;for(_results=[],_i=0,_len=pickers.length;_len>_i;_i++)picker=pickers[_i],_results.push(picker.hide());return _results})},Toolbar.prototype.initButtons=function(){var _this=this;return this.$el.find(".clear-button").click(function(){return _this.lc.clear()}),this.$el.find(".undo-button").click(function(){return _this.lc.undo()}),this.$el.find(".redo-button").click(function(){return _this.lc.redo()})},Toolbar.prototype.initTools=function(){var ToolClass,t,_i,_len,_ref2,_results;for(this.tools=[],_ref2=this.opts.toolClasses,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)ToolClass=_ref2[_i],t=new ToolClass(this.opts),this.tools.push(t),_results.push(this.addTool(t));
return _results},Toolbar.prototype.addTool=function(t){var buttonEl,optsEl,_this=this;return optsEl=$("<div class='tool-options tool-options-"+t.cssSuffix+"'></div>"),optsEl.html(t.options()),optsEl.hide(),t.$el=optsEl,this.$el.find(".tool-options-container").append(optsEl),buttonEl=$("<div class='button tool-"+t.cssSuffix+"'>        <div class='tool-image-wrapper'></div></div>").appendTo(this.$el.find(".tools")).find(".tool-image-wrapper").html(t.button()),buttonEl.click(function(){return _this.selectTool(t)}),null},Toolbar.prototype.initZoom=function(){var _this=this;return this.$el.find(".zoom-in-button").click(function(){return _this.lc.zoom(.2),_this.$el.find(".zoom-display").html(_this.lc.scale)}),this.$el.find(".zoom-out-button").click(function(){return _this.lc.zoom(-.2),_this.$el.find(".zoom-display").html(_this.lc.scale)})},Toolbar.prototype.selectTool=function(t){return this.$el.find(".tools .active").removeClass("active"),this.$el.find(".tools .tool-"+t.cssSuffix).addClass("active"),t.select(this.lc),this.$el.find(".tool-options").hide(),t.$el?t.$el.show():void 0},Toolbar}()}.call(this),function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};LC.Tool=function(){function Tool(){}return Tool.prototype.begin=function(){},Tool.prototype["continue"]=function(){},Tool.prototype.end=function(){},Tool}(),LC.StrokeTool=function(_super){function StrokeTool(){this.strokeWidth=5}return __extends(StrokeTool,_super),StrokeTool}(LC.Tool),LC.RectangleTool=function(_super){function RectangleTool(){RectangleTool.__super__.constructor.apply(this,arguments)}return __extends(RectangleTool,_super),RectangleTool.prototype.begin=function(x,y,lc){return this.currentShape=new LC.Rectangle(x,y,this.strokeWidth,lc.getColor("primary"),lc.getColor("secondary"))},RectangleTool.prototype["continue"]=function(x,y,lc){return this.currentShape.width=x-this.currentShape.x,this.currentShape.height=y-this.currentShape.y,lc.update(this.currentShape)},RectangleTool.prototype.end=function(x,y,lc){return lc.saveShape(this.currentShape)},RectangleTool}(LC.StrokeTool),LC.LineTool=function(_super){function LineTool(){LineTool.__super__.constructor.apply(this,arguments)}return __extends(LineTool,_super),LineTool.prototype.begin=function(x,y,lc){return this.currentShape=new LC.Line(x,y,x,y,this.strokeWidth,lc.getColor("primary"))},LineTool.prototype["continue"]=function(x,y,lc){return this.currentShape.x2=x,this.currentShape.y2=y,lc.update(this.currentShape)},LineTool.prototype.end=function(x,y,lc){return lc.saveShape(this.currentShape)},LineTool}(LC.StrokeTool),LC.Pencil=function(_super){function Pencil(){Pencil.__super__.constructor.apply(this,arguments)}return __extends(Pencil,_super),Pencil.prototype.begin=function(x,y,lc){return this.color=lc.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(x,y,lc))},Pencil.prototype["continue"]=function(x,y,lc){return this.currentShape.addPoint(this.makePoint(x,y,lc)),lc.update(this.currentShape)},Pencil.prototype.end=function(x,y,lc){return lc.saveShape(this.currentShape),this.currentShape=void 0},Pencil.prototype.makePoint=function(x,y){return new LC.Point(x,y,this.strokeWidth,this.color)},Pencil.prototype.makeShape=function(){return new LC.LinePathShape(this)},Pencil}(LC.StrokeTool),LC.Eraser=function(_super){function Eraser(){this.strokeWidth=10}return __extends(Eraser,_super),Eraser.prototype.makePoint=function(x,y){return new LC.Point(x,y,this.strokeWidth,"#000")},Eraser.prototype.makeShape=function(){return new LC.EraseLinePathShape(this)},Eraser}(LC.Pencil),LC.Pan=function(_super){function Pan(){Pan.__super__.constructor.apply(this,arguments)}return __extends(Pan,_super),Pan.prototype.begin=function(x,y){return this.start={x:x,y:y}},Pan.prototype["continue"]=function(x,y,lc){return lc.pan(this.start.x-x,this.start.y-y),lc.repaint()},Pan}(LC.Tool),LC.EyeDropper=function(_super){function EyeDropper(){EyeDropper.__super__.constructor.apply(this,arguments)}return __extends(EyeDropper,_super),EyeDropper.prototype.readColor=function(x,y,lc){var newColor;return newColor=lc.getPixel(x,y),lc.setColor("primary",newColor||lc.getColor("background"))},EyeDropper.prototype.begin=function(x,y,lc){return this.readColor(x,y,lc)},EyeDropper.prototype["continue"]=function(x,y,lc){return this.readColor(x,y,lc)},EyeDropper}(LC.Tool),LC.TextTool=function(_super){function TextTool(text){this.text=null!=text?text:""}return __extends(TextTool,_super),TextTool.prototype.setText=function(text){return this.text=text},TextTool.prototype.begin=function(x,y,lc){return this.color=lc.getColor("primary"),this.currentShape=new LC.TextShape(x,y,this.text,this.color)},TextTool.prototype["continue"]=function(x,y,lc){return this.currentShape.x=x,this.currentShape.y=y,lc.update(this.currentShape)},TextTool.prototype.end=function(x,y,lc){return lc.saveShape(this.currentShape)},TextTool}(LC.Tool)}.call(this),function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};LC.Widget=function(){function Widget(opts){this.opts=opts}return Widget.prototype.title=void 0,Widget.prototype.cssSuffix=void 0,Widget.prototype.button=function(){},Widget.prototype.options=function(){},Widget.prototype.select=function(){},Widget}(),LC.ToolWidget=function(_super){function ToolWidget(opts){this.opts=opts,this.tool=this.makeTool()}return __extends(ToolWidget,_super),ToolWidget.prototype.select=function(lc){return lc.setTool(this.tool)},ToolWidget.prototype.makeTool=function(){},ToolWidget}(LC.Widget),LC.StrokeWidget=function(_super){function StrokeWidget(){StrokeWidget.__super__.constructor.apply(this,arguments)}return __extends(StrokeWidget,_super),StrokeWidget.prototype.options=function(){var $brushWidthVal,$el,$input,_this=this;return $el=$("<span class='brush-width-min'>1 px</span><input type='range' min='1' max='50' step='1' value='"+this.tool.strokeWidth+"'><span class='brush-width-max'>50 px</span><span class='brush-width-val'>(5 px)</span>"),$input=$el.filter("input"),0===$input.size()&&($input=$el.find("input")),$brushWidthVal=$el.filter(".brush-width-val"),0===$brushWidthVal.size()&&($brushWidthVal=$el.find(".brush-width-val")),$input.change(function(e){return _this.tool.strokeWidth=parseInt($(e.currentTarget).val(),10),$brushWidthVal.html("("+_this.tool.strokeWidth+" px)")}),$el},StrokeWidget}(LC.ToolWidget),LC.RectangleWidget=function(_super){function RectangleWidget(){RectangleWidget.__super__.constructor.apply(this,arguments)}return __extends(RectangleWidget,_super),RectangleWidget.prototype.title="Rectangle",RectangleWidget.prototype.cssSuffix="rectangle",RectangleWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/rectangle.png'>"},RectangleWidget.prototype.makeTool=function(){return new LC.RectangleTool},RectangleWidget}(LC.StrokeWidget),LC.LineWidget=function(_super){function LineWidget(){LineWidget.__super__.constructor.apply(this,arguments)}return __extends(LineWidget,_super),LineWidget.prototype.title="Line",LineWidget.prototype.cssSuffix="line",LineWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/line.png'>"},LineWidget.prototype.makeTool=function(){return new LC.LineTool},LineWidget}(LC.StrokeWidget),LC.PencilWidget=function(_super){function PencilWidget(){PencilWidget.__super__.constructor.apply(this,arguments)}return __extends(PencilWidget,_super),PencilWidget.prototype.title="Pencil",PencilWidget.prototype.cssSuffix="pencil",PencilWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/pencil.png'>"},PencilWidget.prototype.makeTool=function(){return new LC.Pencil},PencilWidget}(LC.StrokeWidget),LC.EraserWidget=function(_super){function EraserWidget(){EraserWidget.__super__.constructor.apply(this,arguments)}return __extends(EraserWidget,_super),EraserWidget.prototype.title="Eraser",EraserWidget.prototype.cssSuffix="eraser",EraserWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/eraser.png'>"},EraserWidget.prototype.makeTool=function(){return new LC.Eraser},EraserWidget}(LC.PencilWidget),LC.PanWidget=function(_super){function PanWidget(){PanWidget.__super__.constructor.apply(this,arguments)}return __extends(PanWidget,_super),PanWidget.prototype.title="Pan",PanWidget.prototype.cssSuffix="pan",PanWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/pan.png'>"},PanWidget.prototype.makeTool=function(){return new LC.Pan},PanWidget}(LC.ToolWidget),LC.EyeDropperWidget=function(_super){function EyeDropperWidget(){EyeDropperWidget.__super__.constructor.apply(this,arguments)}return __extends(EyeDropperWidget,_super),EyeDropperWidget.prototype.title="Eyedropper",EyeDropperWidget.prototype.cssSuffix="eye-dropper",EyeDropperWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/eyedropper.png'>"},EyeDropperWidget.prototype.makeTool=function(){return new LC.EyeDropper},EyeDropperWidget}(LC.ToolWidget),LC.TextWidget=function(_super){function TextWidget(){TextWidget.__super__.constructor.apply(this,arguments)}return __extends(TextWidget,_super),TextWidget.prototype.title="Text",TextWidget.prototype.cssSuffix="text",TextWidget.prototype.button=function(){return"<img src='"+this.opts.imageURLPrefix+"/text.png'>"},TextWidget.prototype.select=function(lc){var _this=this;return lc.setTool(this.tool),setTimeout(function(){return _this.$input.focus(),_this.$input.select()},0)},TextWidget.prototype.makeTool=function(){return new LC.TextTool},TextWidget.prototype.options=function(){var $el,_this=this;return $el=$("<input type='text' placeholder='Enter text here'        value='"+this.tool.text+"'>       <span class='instructions'>Click and hold to place text.</span>"),this.$input=$el.filter("input"),0===this.$input.size()&&(this.$input=$el.find("input")),this.$input.change(function(){return _this.tool.text=_this.$input.val()}),this.$input.keyup(function(){return _this.tool.text=_this.$input.val()}),$el},TextWidget}(LC.ToolWidget)}.call(this),function(){var slice,_ref;window.LC=null!=(_ref=window.LC)?_ref:{},slice=Array.prototype.slice,LC._last=function(array,n){return null==n&&(n=null),n?slice.call(array,Math.max(array.length-n,0)):array[array.length-1]},LC.init=function(el,opts){var $el,$tbEl,lc,resize,tb;return null==opts&&(opts={}),null==opts.primaryColor&&(opts.primaryColor="#000"),null==opts.secondaryColor&&(opts.secondaryColor="#fff"),null==opts.backgroundColor&&(opts.backgroundColor="transparent"),null==opts.imageURLPrefix&&(opts.imageURLPrefix="lib/img"),null==opts.keyboardShortcuts&&(opts.keyboardShortcuts=!0),null==opts.preserveCanvasContents&&(opts.preserveCanvasContents=!1),null==opts.sizeToContainer&&(opts.sizeToContainer=!0),null==opts.backgroundShapes&&(opts.backgroundShapes=[]),null==opts.watermarkImage&&(opts.watermarkImage=null),"toolClasses"in opts||(opts.toolClasses=[LC.PencilWidget,LC.EraserWidget,LC.LineWidget,LC.RectangleWidget,LC.TextWidget,LC.PanWidget,LC.EyeDropperWidget]),$el=$(el),$el.addClass("literally"),$tbEl=$('<div class="toolbar">'),$el.append($tbEl),$el.find("canvas").length||$el.append("<canvas>"),lc=new LC.LiterallyCanvas($el.find("canvas").get(0),opts),tb=new LC.Toolbar(lc,$tbEl,opts),tb.selectTool(tb.tools[0]),resize=function(){return opts.sizeToContainer&&lc.$canvas.css("height",""+($el.height()-$tbEl.height())+"px"),lc.updateSize()},$el.resize(resize),$(window).bind("orientationchange resize",resize),resize(),"onInit"in opts&&opts.onInit(lc),[lc,tb]},$.fn.literallycanvas=function(opts){return null==opts&&(opts={}),this.each(function(ix,el){var _ref2;return _ref2=LC.init(el,opts),el.literallycanvas=_ref2[0],el.literallycanvasToolbar=_ref2[1],_ref2}),this}}.call(this);